# PyHP

PyHP is an (incomplete!) implementation of the PHP language using the
[RPython](http://pypy.org) technology.

PyHP stands for Python + PHP, as RRpython is a subset of the Python language.

Highly unstable and work in progress.

[HippyVM](https://github.com/hippyvm/hippyvm) is too built on top of RPython,
and is a complete, working implementation.

## Project structure

- `main.py` - main entry point
- `sourceparcer.py` - parses a given PHP file using the `grammar.txt` definition,
and produces an AST tree consisting of `operations.py` nodes
- `bytecode.py` - turns the AST tree produced by `sourceparcer.py` into bytecode
by calling `compile()` on the tree
- `interpreter.py` - takes the bytecode generated by `bytecode.py` and executes it
- `grammar.txt` - EBNF PHP grammar used by `sourceparcer.py`
- `operations.py` - AST tree nodes

## Building

### Starting the VM

    vagrant up
    vagrant ssh
    cd /var/www/pyhp

### Building the interpreter

    rpython -Ojit targetpyhp.py

Emit the `-Ojit` to compile an interpreter without JIT support. Speeds up the build
process by 5x, but the produced interpreter runs much slower.

### Running the interpreter

    ./pyhp-c fibonacci.php

### Debugging the interpreter

    PYPYLOG=jit-log-opt:jit.txt ./pyhp-c fibonacci.php
    PYTHONPATH=$PYTHONPATH:/home/vagrant/pypy-src/ python ~/pypy-src/rpython/tool/logparser.py draw-time jit.txt --mainwidth=8000 filename.png

### Run tests

    PYTHONPATH=$PYTHONPATH:/home/vagrant/pypy-src/ py.test tests

## Attributions and inspirations

[JavaScript on top of RPython](https://bitbucket.org/pypy/lang-js/src/de89ec32a7dc?at=default)

[Example interpreter](https://bitbucket.org/pypy/example-interpreter/src/a00d0f9c36f1?at=default)

[Pascal on top of RPython](https://github.com/WarPie/Pascal)

[HippyVM - php on top of RPython](https://github.com/hippyvm/hippyvm)
